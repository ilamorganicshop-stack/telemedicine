{% extends 'accounts/hospital_admin_base.html' %}

{% block title %}Hospital Admin Dashboard{% endblock %}

{% block hospital_admin_content %}
<div class="p-4 sm:p-6 lg:p-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Hospital Admin Dashboard</h1>
        <p class="mt-2 text-gray-600">Manage {{ hospital.name }} - doctors, patients, and appointments</p>
    </div>

    <div class="mb-8 grid grid-cols-1 gap-6 md:grid-cols-3">
        <div class="overflow-hidden rounded-lg bg-white shadow">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="flex h-8 w-8 items-center justify-center rounded-md bg-green-500">
                            <span class="text-sm font-medium text-white">D</span>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="truncate text-sm font-medium text-gray-500">Total Doctors</dt>
                            <dd class="text-lg font-medium text-gray-900">{{ doctors_count }}</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <div class="overflow-hidden rounded-lg bg-white shadow">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="flex h-8 w-8 items-center justify-center rounded-md bg-blue-500">
                            <span class="text-sm font-medium text-white">P</span>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="truncate text-sm font-medium text-gray-500">Total Patients</dt>
                            <dd class="text-lg font-medium text-gray-900">{{ patients_count }}</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <div class="overflow-hidden rounded-lg bg-white shadow">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="flex h-8 w-8 items-center justify-center rounded-md bg-purple-500">
                            <span class="text-sm font-medium text-white">H</span>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="truncate text-sm font-medium text-gray-500">Hospital</dt>
                            <dd class="text-lg font-medium text-gray-900">{{ hospital.name }}</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Section -->
    {% if notifications %}
    <div class="mb-8 rounded-lg bg-white shadow">
        <div class="border-b border-gray-200 px-4 py-5 sm:p-6">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-medium text-gray-900">Recent Notifications</h2>
                <div class="flex items-center gap-3">
                    <span class="inline-block rounded-full bg-blue-100 px-3 py-1 text-sm font-semibold text-blue-800">{{ unread_notifications_count }} New</span>
                    <form method="post" action="{% url 'accounts:clear_notifications' %}">
                        {% csrf_token %}
                        <input type="hidden" name="next" value="{{ request.get_full_path }}">
                        <button type="submit" class="rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs font-semibold text-gray-700 hover:bg-gray-100 transition-colors">
                            Clear Notifications
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <div class="divide-y divide-gray-200">
            {% for notification in notifications %}
            <div class="flex items-start justify-between gap-4 px-4 py-4 sm:p-6">
                <div class="flex-1">
                    <p class="font-medium text-gray-900">{{ notification.title }}</p>
                    <p class="mt-1 text-sm text-gray-600">{{ notification.message }}</p>
                    <p class="mt-2 text-xs text-gray-500">{{ notification.created_at|timesince }} ago</p>
                </div>
                {% if notification.appointment %}
                <a href="{% url 'accounts:manage_appointments' %}" class="text-blue-600 hover:text-blue-800 text-sm whitespace-nowrap">View â†’</a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="mb-8 grid gap-6 lg:grid-cols-2">
        <div class="rounded-lg bg-white shadow">
            <div class="border-b border-gray-200 px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900">Team Management</h2>
            </div>
            <div class="space-y-2 px-4 py-4 sm:p-6">
                <a href="{% url 'accounts:create_doctor' %}" class="block rounded-md border border-transparent bg-green-600 px-4 py-2 text-center font-medium text-white hover:bg-green-700">
                    Create New Doctor
                </a>
                <a href="{% url 'accounts:manage_doctors' %}" class="block rounded-md border border-transparent bg-blue-600 px-4 py-2 text-center font-medium text-white hover:bg-blue-700">
                    Manage Doctors
                </a>
                <a href="{% url 'accounts:create_patient' %}" class="block rounded-md border border-transparent bg-purple-600 px-4 py-2 text-center font-medium text-white hover:bg-purple-700">
                    Create New Patient
                </a>
                <a href="{% url 'accounts:manage_patients' %}" class="block rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-center font-medium text-white hover:bg-indigo-700">
                    Manage Patients
                </a>
            </div>
        </div>

        <div class="rounded-lg bg-white shadow">
            <div class="border-b border-gray-200 px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900">Appointment Flow</h2>
            </div>
            <div class="space-y-2 px-4 py-4 sm:p-6">
                <a href="{% url 'accounts:book_appointment' %}" class="block rounded-md border border-transparent bg-green-600 px-4 py-2 text-center font-medium text-white hover:bg-green-700">
                    Book Appointment
                </a>
                <a href="{% url 'accounts:manage_appointments' %}" class="block rounded-md border border-transparent bg-blue-600 px-4 py-2 text-center font-medium text-white hover:bg-blue-700">
                    Manage Appointments
                </a>
            </div>
        </div>
    </div>

    <div class="mb-8 grid gap-6 lg:grid-cols-2">
        <div class="rounded-lg bg-white shadow">
            <div class="border-b border-gray-200 px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900">Recent Doctors</h2>
            </div>
            <div class="divide-y divide-gray-200">
                {% for doctor in doctors|slice:":5" %}
                    <div class="flex items-center justify-between px-4 py-4 sm:p-6">
                        <div>
                            <p class="font-medium text-gray-900">Dr. {{ doctor.first_name }} {{ doctor.last_name }}</p>
                            <p class="text-xs text-gray-600">{{ doctor.doctor_profile.specialization|default:"General" }}</p>
                        </div>
                        <span class="text-xs text-gray-500">{{ doctor.created_at|date:"M d" }}</span>
                    </div>
                {% empty %}
                    <div class="px-4 py-4 sm:p-6">
                        <p class="text-sm text-gray-600">No doctors found.</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="rounded-lg bg-white shadow">
            <div class="border-b border-gray-200 px-4 py-5 sm:p-6">
                <h2 class="text-lg font-medium text-gray-900">Recent Patients</h2>
            </div>
            <div class="divide-y divide-gray-200">
                {% for patient in patients|slice:":5" %}
                    <div class="flex items-center justify-between px-4 py-4 sm:p-6">
                        <div>
                            <p class="font-medium text-gray-900">{{ patient.first_name }} {{ patient.last_name }}</p>
                            <p class="text-xs text-gray-600">{{ patient.phone|default:"No phone" }}</p>
                        </div>
                        <span class="text-xs text-gray-500">{{ patient.created_at|date:"M d" }}</span>
                    </div>
                {% empty %}
                    <div class="px-4 py-4 sm:p-6">
                        <p class="text-sm text-gray-600">No patients found.</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
